<!--
  Copyright (c) Microsoft Corporation. All Rights Reserved.
  Licensed under the MIT license. See LICENSE file on the project webpage for details.
  -->
<script>
    var browser_protection_type = getPlayerType()
    if ("${protection_type}" == "Both"){
        if(browser_protection_type == 'AES'){
            new_protection = $("source").attr('data-setup').replace("${protection_type}",browser_protection_type);
            $("source").attr('data-setup', new_protection);
        }else{
                if ("${protection_type}" != '' && "${auth_token}" != '' && "${video_url}" != '') {
                new_protection = $("source").attr('data-setup').replace("${protection_type}", browser_protection_type);
                new_token = new_protection.replace("${auth_token}", "${auth_token_drm}");
                new_video_url = $("source").attr('src').replace("${video_url}", "${video_url_drm}");
                $("source").attr('data-setup', new_token);
                $("source").attr('src', new_video_url);
            }
        }
    }else if("${protection_type}" == "DRM" || "${protection_type}" == "Widevine" || "${protection_type}" == "PlayReady" || "${protection_type}" == "FairPlay"){
        new_protection = $("source").attr('data-setup').replace("${protection_type}",browser_protection_type);
        $("source").attr('data-setup', new_protection);
    }
    function getPlayerType() {
        var is_chrome = navigator.userAgent.indexOf('Chrome') > -1;
        var is_edge = navigator.userAgent.indexOf('Edge') > -1;
        var is_firefox = navigator.userAgent.indexOf('Firefox') > -1;
        var is_safari = navigator.userAgent.indexOf("Safari") > -1;
        var is_opera = navigator.userAgent.toLowerCase().indexOf("op") > -1;
        var playerType = "AES";
        if ((is_chrome) && (is_safari)) {
            is_safari = false;
        }
        if ((is_chrome) && (is_opera)) {
            is_chrome = false;
        }
        if ((is_chrome) && (is_edge)) {
            is_chrome = false;
        }

        var webkit = /WebKit/.test(navigator.userAgent);
        var opera = window.opera && window.opera.buildNumber;

        var ie = !webkit && !opera && (/MSIE/gi).test(navigator.userAgent) && (/Explorer/gi).test(nav.appName);
        ie = ie && /MSIE (\w+)\./.exec(userAgent)[1];
        var ie11 = navigator.userAgent.indexOf('Trident/') != -1 && (navigator.userAgent.indexOf('rv:') != -1 || navigator.appName.indexOf('Netscape') != -1) ? 11 : false;

        var is_explorer = ie || ie11;
        if (is_chrome || is_firefox) {
            playerType = "Widevine";
        }
        else if (is_edge || is_explorer) {
            playerType = "PlayReady";
        }
        else if (is_safari) {
            playerType = "AES";
        }
        return playerType;
    }
</script>
<div class="xmodule_display xmodule_VideoModule">
<div class="video closed">

    <div class="tc-wrapper">
        <div class="azuremediaplayer">
            <video class="amp-default-skin amp-big-play-centered video-wrapper"
                   data-setup='{ "controls": true, "autoplay": false, "logo": {"enabled": false}, "height": 460 }'>
                <source
                    src="${video_url}"
                    type="application/vnd.ms-sstr+xml"
% if protection_type:
                    data-setup='{"protectionInfo": [{"type": "${protection_type}", "authenticationToken": "Bearer=${auth_token}"}]}'
% endif
                />

% for caption in captions:
                <track kind="${caption['kind']}" src="${caption['src']}" srclang="${caption['srclang']}" label="${caption['label']}" />
% endfor

            </video>
        </div>

% if transcript_url:
        <div class="subtitles" data-transcript-url="${transcript_url}">
            ## This element is re-parented dynamically after the AMP is initialized and other buttons are positioned.
            <div class="azure-media-player-toggle-button-style fa fa-quote-left toggleTranscript" role="button" aria-live="polite" tabindex="0">
                <div class="vjs-control-content"><span class="vjs-control-text">Toggle</span></div>
            </div>
        </div>
% endif
    </div>

<ul class="wrapper-downloads">

% if download_url:
	<li style="list-style-type: none;" class="video-sources video-download-button">
		<a role:"button" href="${download_url}" download>Download video</a>
	</li>
% endif
% if transcript_url:
	<li style="list-style-type: none;" class="video-tracks video-download-button">
		<a role:"button" href="${transcript_url}" download>Download transcript</a>
	</li>
% endif

</ul>

</div>
</div>